<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>MusicWave ‚Äî –∂—ë–ª—Ç–æ‚Äë—á—ë—Ä–Ω—ã–π –ø–ª–µ–µ—Ä</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      /* –¶–≤–µ—Ç–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –±–ª–∏–∑–∫–æ –∫ –Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–µ */
      --bg: #111317;
      --bg-elevated: #181a1f;
      --bg-soft: #20232b;
      --accent: #ffcc00;
      --accent-soft: rgba(255, 204, 0, 0.18);
      --text: #f9fafb;
      --text-muted: #8b8f99;
      --border: #2b2e37;
      --radius-lg: 14px;
      --radius-md: 10px;
      --shadow: 0 18px 40px rgba(0, 0, 0, 0.7);
      --transition: 0.18s ease-out;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: stretch;
      padding: 0;
    }
    .app {
      width: 100%;
      max-width: 1280px;
      margin: 0 auto;
      background: var(--bg);
      display: grid;
      grid-template-columns: 260px minmax(0, 1fr);
      grid-template-rows: 56px minmax(0, 1fr) 80px;
      grid-template-areas:
        "header header"
        "sidebar main"
        "player player";
    }
    @media (max-width: 820px) {
      .app {
        grid-template-columns: minmax(0, 1fr);
        grid-template-rows: 60px auto minmax(0, 1fr) 80px;
        grid-template-areas:
          "header"
          "sidebar"
          "main"
          "player";
      }
    }

    .header {
      grid-area: header;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.7);
      background: #181a1f;
    }
    .logo { display: flex; align-items: center; gap: 10px; }
    .logo-icon {
      width: 26px; height: 26px; border-radius: 50%;
      background: radial-gradient(circle at 30% 0, #ffcc00, #ff9800);
      display: flex; align-items: center; justify-content: center;
      font-size: 13px; font-weight: 700; color: #111317;
    }
    .logo-text { font-size: 16px; font-weight: 700; }
    .header-actions { display: flex; align-items: center; gap: 10px; font-size: 12px; }
    .user-email {
      color: var(--text-muted);
      max-width: 180px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .btn-outline {
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 6px 12px;
      font-size: 12px;
      background: transparent;
      color: var(--text);
      cursor: pointer;
      transition: background var(--transition), border-color var(--transition);
    }
    .btn-outline:hover {
      background: rgba(255, 255, 255, 0.04);
      border-color: #3b3f4a;
    }
    .btn-accent {
      border-radius: 999px;
      border: none;
      padding: 6px 14px;
      font-size: 12px;
      background: var(--accent);
      color: #111317;
      cursor: pointer;
      font-weight: 600;
      transition: filter var(--transition), transform var(--transition);
    }
    .btn-accent:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
    }

    .sidebar {
      grid-area: sidebar;
      border-right: 1px solid rgba(0, 0, 0, 0.7);
      background: #181a1f;
      padding: 12px 16px 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .nav-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #6d717c;
      margin: 8px 0 6px;
    }
    .nav-list { list-style: none; display: flex; flex-direction: column; gap: 4px; }
    .nav-item {
      padding: 7px 10px;
      border-radius: 999px;
      font-size: 13px;
      color: var(--text-muted);
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background var(--transition), color var(--transition), transform var(--transition);
    }
    .nav-item span:nth-child(1) { font-weight: 500; }
    .nav-item:hover {
      background: rgba(255, 255, 255, 0.04);
      color: var(--text);
      transform: translateY(-1px);
    }
    .nav-item.active {
      background: var(--accent-soft);
      color: var(--accent);
    }

    .playlist-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 3px;
      max-height: 180px;
      overflow-y: auto;
      padding-right: 4px;
    }
    .playlist-item {
      font-size: 12px;
      padding: 5px 6px;
      border-radius: 9px;
      color: var(--text-muted);
      cursor: pointer;
      transition: background var(--transition), color var(--transition);
    }
    .playlist-item:hover {
      background: var(--bg-soft);
      color: var(--text);
    }
    .user-mini {
      margin-top: auto;
      padding-top: 10px;
      border-top: 1px solid rgba(0, 0, 0, 0.7);
      font-size: 12px;
      color: var(--text-muted);
    }

    .main {
      grid-area: main;
      padding: 16px 24px;
      background: var(--bg-elevated);
      display: flex;
      flex-direction: column;
      gap: 14px;
    }
    .search {
      width: 100%;
      display: flex;
      gap: 8px;
      align-items: center;
      background: var(--bg-soft);
      border-radius: 999px;
      padding: 7px 10px;
      border: 1px solid var(--border);
      font-size: 13px;
      color: var(--text-muted);
    }
    .search input {
      border: none; background: transparent; color: var(--text);
      outline: none; font-size: 13px; width: 100%;
    }
    .search input::placeholder { color: var(--text-muted); }
    .chips { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 10px; margin-bottom: 6px; }
    .chip {
      padding: 5px 9px;
      border-radius: 999px;
      border: 1px solid var(--border);
      font-size: 11px;
      color: var(--text-muted);
      cursor: pointer;
      background: transparent;
      transition: background var(--transition), color var(--transition), border-color var(--transition);
    }
    .chip:hover { background: var(--bg-soft); color: var(--text); }
    .chip.active { border-color: transparent; background: var(--accent); color: #020204; }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 6px;
      margin-bottom: 8px;
    }
    .section-title { font-size: 18px; font-weight: 600; }
    .section-sub { font-size: 12px; color: var(--text-muted); }
    .section-link { font-size: 11px; color: var(--text-muted); cursor: pointer; }
    .section-link:hover { color: var(--accent); }

    .track-list {
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      background: #1b1e24;
      overflow: hidden;
    }
    .track-row {
      display: grid;
      grid-template-columns: 28px minmax(0, 1.8fr) minmax(0, 1fr) 60px;
      gap: 8px;
      align-items: center;
      padding: 8px 12px;
      font-size: 13px;
      cursor: pointer;
      transition: background var(--transition);
    }
    @media (max-width: 640px) {
      .track-row {
        grid-template-columns: 26px minmax(0, 2fr) 55px;
        grid-template-rows: auto auto;
        row-gap: 2px;
      }
      .track-artist { grid-column: 2 / 3; }
      .track-album { display: none; }
    }
    .track-row:nth-child(odd),
    .track-row:nth-child(even) {
      background: transparent;
      border-bottom: 1px solid rgba(0, 0, 0, 0.8);
    }
    .track-row:hover {
      background: rgba(255, 255, 255, 0.04);
    }
    .track-row.active {
      background: rgba(255, 255, 255, 0.06);
      border-left: 3px solid var(--accent);
    }
    .track-index { font-size: 11px; color: var(--text-muted); text-align: center; }
    .track-title {
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .track-artist {
      font-size: 12px;
      color: var(--text-muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .track-album {
      font-size: 12px;
      color: var(--text-muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .track-time { font-size: 12px; text-align: right; color: var(--text-muted); }
    .track-actions { display: flex; gap: 8px; margin-top: 8px; }
    .btn-small {
      font-size: 11px;
      padding: 5px 9px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      transition: background var(--transition), color var(--transition), border-color var(--transition);
    }
    .btn-small:hover {
      background: var(--bg-soft);
      color: var(--text);
      border-color: #4b5563;
    }

    .add-track-panel {
      margin-top: 14px;
      padding: 10px 12px;
      border-radius: var(--radius-lg);
      border: 1px dashed var(--border);
      background: #181a1f;
      font-size: 12px;
    }
    .add-track-title {
      font-weight: 600;
      margin-bottom: 6px;
    }
    .add-track-row {
      display: flex;
      gap: 8px;
      margin-bottom: 6px;
      flex-wrap: wrap;
    }
    .add-track-row .form-input {
      flex: 1;
      min-width: 120px;
    }
    .add-track-hint {
      font-size: 11px;
      color: var(--text-muted);
    }

    .player {
      grid-area: player;
      padding: 10px 24px;
      border-top: 1px solid rgba(0, 0, 0, 0.8);
      background: #181a1f;
      display: grid;
      grid-template-columns: minmax(0, 1.7fr) minmax(0, 2fr) minmax(0, 1.2fr);
      align-items: center;
      gap: 14px;
    }
    @media (max-width: 820px) {
      .player {
        grid-template-columns: minmax(0, 1.7fr) minmax(0, 2fr);
        grid-template-rows: auto auto;
      }
    }
    @media (max-width: 640px) {
      .player {
        grid-template-columns: minmax(0, 1fr);
        grid-auto-rows: auto;
      }
    }
    .player-track { display: flex; align-items: center; gap: 10px; min-width: 0; }
    .player-cover {
      width: 46px; height: 46px; border-radius: 12px;
      background: radial-gradient(circle at 30% 0, #facc15, #f97316);
      display: flex; align-items: center; justify-content: center;
      font-size: 11px; color: #020204; font-weight: 700;
    }
    .player-meta { min-width: 0; }
    .player-title {
      font-size: 13px; font-weight: 600;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .player-artist {
      font-size: 11px; color: var(--text-muted);
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .player-controls {
      display: flex; flex-direction: column; align-items: center; gap: 4px;
    }
    .player-btns { display: flex; align-items: center; gap: 6px; margin-bottom: 2px; }
    .icon-btn {
      width: 26px; height: 26px; border-radius: 999px;
      border: 1px solid var(--border);
      background: transparent; color: var(--text-muted);
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; font-size: 12px;
      transition: background var(--transition), color var(--transition), border-color var(--transition), transform var(--transition);
    }
    .icon-btn:hover {
      background: var(--bg-soft);
      color: var(--text);
      border-color: #4b5563;
      transform: translateY(-1px);
    }
    .icon-btn.main { width: 32px; height: 32px; border-color: var(--accent); color: var(--accent); }
    .player-time { display: flex; align-items: center; gap: 8px; width: 100%; }
    .player-time span { font-size: 10px; color: var(--text-muted); white-space: nowrap; }
    .progress {
      flex: 1; height: 4px; border-radius: 999px;
      background: #111827; overflow: hidden;
      position: relative; cursor: pointer;
    }
    .progress-inner {
      position: absolute; inset: 0; width: 0%;
      background: linear-gradient(90deg, #facc15, #f97316);
    }
    .player-extra {
      display: flex; align-items: center; justify-content: flex-end;
      gap: 10px; font-size: 11px; color: var(--text-muted);
    }
    .volume { display: flex; align-items: center; gap: 6px; min-width: 90px; }
    .volume input[type="range"] { width: 80px; }

    .modal-backdrop {
      position: fixed; inset: 0;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }
    .modal {
      width: 100%; max-width: 360px;
      background: #020204;
      border-radius: 16px;
      padding: 16px 16px 14px;
      border: 1px solid rgba(250, 204, 21, 0.7);
      box-shadow: 0 30px 70px rgba(0, 0, 0, 0.95);
      color: var(--text);
    }
    .modal-header {
      display: flex; justify-content: space-between;
      align-items: center; margin-bottom: 8px;
    }
    .modal-header h2 { font-size: 16px; }
    .modal-close {
      border: none; background: transparent;
      color: var(--text-muted); font-size: 20px; cursor: pointer;
    }
    .modal-sub { font-size: 12px; color: var(--text-muted); margin-bottom: 10px; }
    .form-group { margin-bottom: 8px; }
    .form-group label { display: block; font-size: 12px; margin-bottom: 3px; }
    .form-input {
      width: 100%; border-radius: 10px;
      border: 1px solid var(--border);
      background: #020204; color: var(--text);
      font-size: 13px; padding: 7px 9px;
      outline: none;
    }
    .form-input:focus {
      border-color: #facc15;
      box-shadow: 0 0 0 1px rgba(250, 204, 21, 0.35);
    }
    .modal-footer {
      margin-top: 6px;
      display: flex; justify-content: space-between; align-items: center;
      font-size: 11px; color: var(--text-muted);
    }
    .modal-footer button {
      border: none; background: transparent;
      color: var(--accent); cursor: pointer;
      font-size: 11px; padding: 0;
    }

    .playlist-list::-webkit-scrollbar { width: 4px; }
    .playlist-list::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 999px; }
  </style>
</head>
<body>
  <div class="app">
    <header class="header">
      <div class="logo">
        <div class="logo-icon">MW</div>
        <div class="logo-text">MusicWave</div>
      </div>
      <div class="header-actions">
        <span class="user-email" id="headerUserEmail">–ì–æ—Å—Ç—å</span>
        <button id="loginBtn" class="btn-outline">–í–æ–π—Ç–∏</button>
        <button id="registerBtn" class="btn-accent">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        <button id="logoutBtn" class="btn-outline" style="display:none;">–í—ã–π—Ç–∏</button>
      </div>
    </header>

    <aside class="sidebar">
      <div>
        <div class="nav-title">–†–∞–∑–¥–µ–ª—ã</div>
        <ul class="nav-list">
          <li id="navHome" class="nav-item active"><span>–ì–ª–∞–≤–Ω–∞—è</span><span>‚óè</span></li>
          <li id="navMyMusic" class="nav-item"><span>–ú–æ—è –º—É–∑—ã–∫–∞</span><span>‚ñ∂</span></li>
          <li id="navPlaylists" class="nav-item"><span>–ü–ª–µ–π–ª–∏—Å—Ç—ã</span><span>‚ô™</span></li>
        </ul>
      </div>

      <div class="user-mini" id="sidebarUserInfo">
        –ì–æ—Å—Ç—å ¬∑ –≤–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç—Ä–µ–∫–∏ –∏ –ø–ª–µ–π–ª–∏—Å—Ç—ã
      </div>
    </aside>

    <main class="main">
      <div>
        <div class="search">
          üîç
          <input id="searchInput" type="text" placeholder="–ò—Å–∫–∞—Ç—å —Ç—Ä–µ–∫ –∏–ª–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è..." />
        </div>
        <div class="chips">
          <button class="chip active" data-filter="all">–í—Å–µ</button>
          <button class="chip" data-filter="calm">–°–ø–æ–∫–æ–π–Ω–æ–µ</button>
          <button class="chip" data-filter="energetic">–≠–Ω–µ—Ä–≥–∏—á–Ω–æ–µ</button>
          <button class="chip" data-filter="instrumental">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª</button>
        </div>
      </div>

      <section>
        <div class="section-header">
          <div>
            <div id="sectionTitle" class="section-title">–ü–ª–µ–π–ª–∏—Å—Ç –¥–Ω—è</div>
            <div id="sectionSub" class="section-sub">–†–∞–±–æ—á–∏–π –ø–ª–µ–µ—Ä + —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ localStorage</div>
          </div>
          <div class="section-link" id="shuffleBtn">–ü–µ—Ä–µ–º–µ—à–∞—Ç—å</div>
        </div>

        <div class="track-list" id="trackList"></div>

        <div class="track-actions">
          <button id="addToPlaylistBtn" class="btn-small">+ –î–æ–±–∞–≤–∏—Ç—å –≤ –ø–ª–µ–π–ª–∏—Å—Ç</button>
          <button id="likeBtn" class="btn-small">‚ô° –õ–∞–π–∫</button>
        </div>

        <div class="add-track-panel">
          <div class="add-track-title">–î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π —Ç—Ä–µ–∫</div>
          <div class="add-track-row">
            <input id="userTrackTitle" class="form-input" type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞" />
            <input id="userTrackArtist" class="form-input" type="text" placeholder="–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" />
          </div>
          <div class="add-track-row">
            <input id="userTrackFile" class="form-input" type="file" accept="audio/*" />
            <button id="addTrackBtn" class="btn-accent" style="white-space:nowrap;">–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫</button>
          </div>
          <div class="add-track-hint">
            –§–∞–π–ª —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —ç—Ç–æ–π –≤–∫–ª–∞–¥–∫–µ –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –∏—Å—á–µ–∑–Ω–µ—Ç –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
          </div>
        </div>
      </section>
    </main>

    <footer class="player">
      <div class="player-track">
        <div class="player-cover" id="playerCover">T</div>
        <div class="player-meta">
          <div class="player-title" id="playerTitle">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</div>
          <div class="player-artist" id="playerArtist">–í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–µ–∫ –∏–∑ —Å–ø–∏—Å–∫–∞</div>
        </div>
      </div>

      <div class="player-controls">
        <div class="player-btns">
          <button id="prevBtn" class="icon-btn">‚èÆ</button>
          <button id="playPauseBtn" class="icon-btn main">‚ñ∂</button>
          <button id="nextBtn" class="icon-btn">‚è≠</button>
        </div>
        <div class="player-time">
          <span id="currentTime">0:00</span>
          <div class="progress" id="progressBar">
            <div class="progress-inner" id="progressInner"></div>
          </div>
          <span id="duration">0:00</span>
        </div>
      </div>

      <div class="player-extra">
        <div class="volume">
          üîä
          <input id="volumeRange" type="range" min="0" max="1" step="0.01" value="0.8" />
        </div>
        <span id="playerStatus">–ì–æ—Å—Ç—å ¬∑ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ</span>
      </div>
    </footer>
  </div>

  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal">
      <div class="modal-header">
        <h2 id="modalTitle">–í—Ö–æ–¥</h2>
        <button class="modal-close" id="modalClose">√ó</button>
      </div>
      <p class="modal-sub" id="modalSub">
        –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ (localStorage), –±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞.
      </p>
      <form id="authForm">
        <div class="form-group">
          <label for="emailInput">Email</label>
          <input id="emailInput" class="form-input" type="email" placeholder="you@example.com" required />
        </div>
        <div class="form-group">
          <label for="passwordInput">–ü–∞—Ä–æ–ª—å</label>
          <input id="passwordInput" class="form-input" type="password" placeholder="–ú–∏–Ω–∏–º—É–º 4 —Å–∏–º–≤–æ–ª–∞" required />
        </div>
        <button type="submit" class="btn-accent" style="width:100%;margin-top:4px;">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
      </form>
      <div class="modal-footer">
        <span id="modalSwitchText">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?</span>
        <button id="modalSwitchBtn" type="button">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
      </div>
    </div>
  </div>

  <audio id="audio"></audio>

  <script>
    // –í–ï–°–¨ JS ‚Äî –ë–ï–ó –°–û–í–†–ï–ú–ï–ù–ù–û–ì–û –°–ò–ù–¢–ê–ö–°–ò–°–ê
    var STORAGE_USERS_KEY = "mw_users";
    var STORAGE_CURRENT_USER_KEY = "mw_current_user";

    function loadUsers() {
      try {
        var raw = localStorage.getItem(STORAGE_USERS_KEY);
        return raw ? JSON.parse(raw) : [];
      } catch (e) {
        return [];
      }
    }
    function saveUsers(users) {
      localStorage.setItem(STORAGE_USERS_KEY, JSON.stringify(users));
    }
    function loadCurrentUser() {
      try {
        var raw = localStorage.getItem(STORAGE_CURRENT_USER_KEY);
        return raw ? JSON.parse(raw) : null;
      } catch (e) {
        return null;
      }
    }
    function saveCurrentUser(user) {
      if (user) {
        localStorage.setItem(STORAGE_CURRENT_USER_KEY, JSON.stringify({ email: user.email }));
      } else {
        localStorage.removeItem(STORAGE_CURRENT_USER_KEY);
      }
    }

    var users = loadUsers();
    var currentUser = null;

    function findUserByEmail(email) {
      for (var i = 0; i < users.length; i++) {
        if (users[i].email === email) return users[i];
      }
      return null;
    }
    function getCurrentUserFull() {
      if (!currentUser) return null;
      return findUserByEmail(currentUser.email);
    }

    var tracks = [
      { id: "t1", title: "Lofi Morning",  artist: "Beat Studio",  album: "Soft Focus",        duration: "2:31", mood: "calm",         url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" },
      { id: "t2", title: "City Night Drive", artist: "Neon Waves",  album: "Highway Lights",    duration: "3:48", mood: "energetic",    url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" },
      { id: "t3", title: "Study Rain",    artist: "Calm Rooms",   album: "Deep Concentration", duration: "4:12", mood: "calm",         url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" },
      { id: "t4", title: "Soft Piano",    artist: "Silent Keys",  album: "Evening Notes",      duration: "3:05", mood: "instrumental", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3" }
    ];

    var trackListEl = document.getElementById("trackList");
    var audio = document.getElementById("audio");
    var playerTitle = document.getElementById("playerTitle");
    var playerArtist = document.getElementById("playerArtist");
    var playerCover = document.getElementById("playerCover");
    var playPauseBtn = document.getElementById("playPauseBtn");
    var prevBtn = document.getElementById("prevBtn");
    var nextBtn = document.getElementById("nextBtn");
    var progressBar = document.getElementById("progressBar");
    var progressInner = document.getElementById("progressInner");
    var currentTimeEl = document.getElementById("currentTime");
    var durationEl = document.getElementById("duration");
    var volumeRange = document.getElementById("volumeRange");
    var playerStatus = document.getElementById("playerStatus");
    var headerUserEmail = document.getElementById("headerUserEmail");
    var sidebarUserInfo = document.getElementById("sidebarUserInfo");
    var navHome = document.getElementById("navHome");
    var navMyMusic = document.getElementById("navMyMusic");
    var navPlaylists = document.getElementById("navPlaylists");
    var sectionTitle = document.getElementById("sectionTitle");
    var sectionSub = document.getElementById("sectionSub");
    var userTrackTitle = document.getElementById("userTrackTitle");
    var userTrackArtist = document.getElementById("userTrackArtist");
    var userTrackFile = document.getElementById("userTrackFile");
    var addTrackBtn = document.getElementById("addTrackBtn");

    var currentIndex = 0;
    var isPlaying = false;
    var currentFilter = "all";
    var filteredTracks = tracks.slice();
    var currentTrackId = null;
    var currentView = "home"; // home | my | playlists

    function renderTracks(list) {
      trackListEl.innerHTML = "";
      for (var i = 0; i < list.length; i++) {
        var track = list[i];
        var row = document.createElement("div");
        row.className = "track-row";
        row.setAttribute("data-index", i);
        row.setAttribute("data-id", track.id);
        row.innerHTML =
          '<div class="track-index">' + (i + 1) + '</div>' +
          '<div>' +
            '<div class="track-title">' + track.title + '</div>' +
            '<div class="track-artist">' + track.artist + '</div>' +
          '</div>' +
          '<div class="track-album">' + track.album + '</div>' +
          '<div class="track-time">' + track.duration + '</div>';
        row.onclick = (function(indexCopy) {
          return function() {
            loadTrack(indexCopy);
            playTrack();
          };
        })(i);
        trackListEl.appendChild(row);
      }
      highlightActiveRow();
    }

    function highlightActiveRow() {
      var rows = trackListEl.getElementsByClassName("track-row");
      for (var i = 0; i < rows.length; i++) {
        rows[i].classList.remove("active");
      }
      if (rows[currentIndex]) rows[currentIndex].classList.add("active");
    }

    function loadTrack(index) {
      currentIndex = index;
      var track = filteredTracks[currentIndex];
      if (!track) return;
      audio.src = track.url;
      currentTrackId = track.id;
      playerTitle.textContent = track.title;
      playerArtist.textContent = track.artist;
      playerCover.textContent = (track.title.charAt(0) || "T").toUpperCase();
      highlightActiveRow();
    }

    function playTrack() {
      if (!audio.src) loadTrack(currentIndex);
      var playPromise = audio.play();
      if (playPromise && playPromise.catch) {
        playPromise.then(function() {
          isPlaying = true;
          playPauseBtn.textContent = "‚è∏";
        }).catch(function() {
          alert("–ù–∞–∂–º–∏—Ç–µ –µ—â—ë —Ä–∞–∑ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è ‚Äî –±—Ä–∞—É–∑–µ—Ä –º–æ–≥ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ–∑–≤—É–∫.");
        });
      } else {
        isPlaying = true;
        playPauseBtn.textContent = "‚è∏";
      }
    }

    function pauseTrack() {
      audio.pause();
      isPlaying = false;
      playPauseBtn.textContent = "‚ñ∂";
    }

    playPauseBtn.onclick = function() {
      if (isPlaying) pauseTrack(); else playTrack();
    };

    prevBtn.onclick = function() {
      if (!filteredTracks.length) return;
      currentIndex = (currentIndex - 1 + filteredTracks.length) % filteredTracks.length;
      loadTrack(currentIndex);
      playTrack();
    };

    nextBtn.onclick = function() {
      if (!filteredTracks.length) return;
      currentIndex = (currentIndex + 1) % filteredTracks.length;
      loadTrack(currentIndex);
      playTrack();
    };

    audio.addEventListener("ended", function() {
      if (!filteredTracks.length) return;
      currentIndex = (currentIndex + 1) % filteredTracks.length;
      loadTrack(currentIndex);
      playTrack();
    });

    function formatTime(sec) {
      if (isNaN(sec)) return "0:00";
      var m = Math.floor(sec / 60);
      var s = Math.floor(sec % 60);
      if (s < 10) s = "0" + s;
      return m + ":" + s;
    }

    audio.addEventListener("timeupdate", function() {
      var currentTime = audio.currentTime;
      var duration = audio.duration;
      currentTimeEl.textContent = formatTime(currentTime);
      durationEl.textContent = formatTime(duration);
      var progress = duration ? (currentTime / duration) * 100 : 0;
      progressInner.style.width = progress + "%";
    });

    progressBar.onclick = function(e) {
      var rect = progressBar.getBoundingClientRect();
      var ratio = (e.clientX - rect.left) / rect.width;
      if (!isNaN(audio.duration)) {
        if (ratio < 0) ratio = 0;
        if (ratio > 1) ratio = 1;
        audio.currentTime = audio.duration * ratio;
      }
    };

    volumeRange.oninput = function() {
      audio.volume = parseFloat(volumeRange.value);
    };
    audio.volume = parseFloat(volumeRange.value);

    var searchInput = document.getElementById("searchInput");
    searchInput.oninput = updateFilter;

    var chipButtons = document.getElementsByClassName("chip");
    for (var i = 0; i < chipButtons.length; i++) {
      (function(chip) {
        chip.onclick = function() {
          for (var j = 0; j < chipButtons.length; j++) {
            chipButtons[j].classList.remove("active");
          }
          chip.classList.add("active");
          currentFilter = chip.getAttribute("data-filter") || "all";
          updateFilter();
        };
      })(chipButtons[i]);
    }

    function updateFilter() {
      var search = searchInput.value.toLowerCase();
      filteredTracks = [];

      // –≤—ã–±–∏—Ä–∞–µ–º –±–∞–∑–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ —Ç—Ä–µ–∫–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
      var baseList = tracks;
      var user = getCurrentUserFull();
      if (currentView === "my" && user && user.likes && user.likes.length) {
        baseList = [];
        for (var i = 0; i < user.likes.length; i++) {
          var likeId = user.likes[i];
          for (var j = 0; j < tracks.length; j++) {
            if (tracks[j].id === likeId) {
              baseList.push(tracks[j]);
              break;
            }
          }
        }
      } else if (currentView === "playlists" && user && user.playlists && user.playlists.length) {
        baseList = [];
        for (var p = 0; p < user.playlists.length; p++) {
          var plId = user.playlists[p];
          for (var k = 0; k < tracks.length; k++) {
            if (tracks[k].id === plId) {
              baseList.push(tracks[k]);
              break;
            }
          }
        }
      }

      for (var x = 0; x < baseList.length; x++) {
        var t = baseList[x];
        var matchText =
          t.title.toLowerCase().indexOf(search) !== -1 ||
          t.artist.toLowerCase().indexOf(search) !== -1;
        var matchMood = currentFilter === "all" ? true : t.mood === currentFilter;
        if (matchText && matchMood) filteredTracks.push(t);
      }
      if (!filteredTracks.length) {
        var emptyText = "–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ";
        if (currentView === "my") {
          emptyText = "–ü–æ–∫–∞ –Ω–µ—Ç –ª–∞–π–∫–Ω—É—Ç—ã—Ö —Ç—Ä–µ–∫–æ–≤. –ü–æ—Å—Ç–∞–≤—å—Ç–µ –ª–∞–π–∫, —á—Ç–æ–±—ã –æ–Ω–∏ –ø–æ—è–≤–∏–ª–∏—Å—å –∑–¥–µ—Å—å.";
        } else if (currentView === "playlists") {
          emptyText = "–í–∞—à –ø–ª–µ–π–ª–∏—Å—Ç –ø—É—Å—Ç. –î–æ–±–∞–≤—å—Ç–µ —Ç—Ä–µ–∫–∏ –∫–Ω–æ–ø–∫–æ–π \"+ –î–æ–±–∞–≤–∏—Ç—å –≤ –ø–ª–µ–π–ª–∏—Å—Ç\".";
        }
        trackListEl.innerHTML = '<div style="padding:10px;font-size:12px;color:#6b7280;">' + emptyText + '</div>';
        return;
      }

      // –ø–æ–¥–±–∏—Ä–∞–µ–º –∏–Ω–¥–µ–∫—Å —Ç–µ–∫—É—â–µ–≥–æ —Ç—Ä–µ–∫–∞, —á—Ç–æ–±—ã –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Ä–∞–∑–¥–µ–ª–æ–≤ –º—É–∑—ã–∫–∞ –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–∞—Å—å
      if (currentTrackId) {
        for (var y = 0; y < filteredTracks.length; y++) {
          if (filteredTracks[y].id === currentTrackId) {
            currentIndex = y;
            break;
          }
        }
      } else if (currentIndex >= filteredTracks.length) {
        currentIndex = 0;
      }

      renderTracks(filteredTracks);
    }

    document.getElementById("addToPlaylistBtn").onclick = function() {
      var user = getCurrentUserFull();
      if (!user) {
        alert("–ß—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç—ã, —Å–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å.");
        return;
      }
      var track = filteredTracks[currentIndex];
      if (!track) return;
      if (!user.playlists) user.playlists = [];
      if (user.playlists.indexOf(track.id) === -1) {
        user.playlists.push(track.id);
        saveUsers(users);
        alert("–¢—Ä–µ–∫ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≤–∞—à –ø–ª–µ–π–ª–∏—Å—Ç.");
      } else {
        alert("–≠—Ç–æ—Ç —Ç—Ä–µ–∫ —É–∂–µ –≤ –≤–∞—à–µ–º –ø–ª–µ–π–ª–∏—Å—Ç–µ.");
      }
    };

    document.getElementById("likeBtn").onclick = function() {
      var user = getCurrentUserFull();
      if (!user) {
        alert("–ß—Ç–æ–±—ã —Å—Ç–∞–≤–∏—Ç—å –ª–∞–π–∫–∏, —Å–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å.");
        return;
      }
      var track = filteredTracks[currentIndex];
      if (!track) return;
      if (!user.likes) user.likes = [];
      var idx = user.likes.indexOf(track.id);
      if (idx === -1) {
        user.likes.push(track.id);
        saveUsers(users);
        alert("–¢—Ä–µ–∫ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≤–∞—à–∏ –ª–∞–π–∫–∏.");
      } else {
        user.likes.splice(idx, 1);
        saveUsers(users);
        alert("–õ–∞–π–∫ —Å–Ω—è—Ç.");
      }
    };

    document.getElementById("shuffleBtn").onclick = function() {
      if (!filteredTracks.length) return;
      var rand = Math.floor(Math.random() * filteredTracks.length);
      loadTrack(rand);
      playTrack();
    };

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ç—Ä–µ–∫–∞ –∏–∑ —Ñ–∞–π–ª–∞
    addTrackBtn.onclick = function() {
      var title = (userTrackTitle.value || "").trim();
      var artist = (userTrackArtist.value || "").trim();
      var file = userTrackFile.files[0];
      if (!file) {
        alert("–í—ã–±–µ—Ä–∏—Ç–µ –∞—É–¥–∏–æ-—Ñ–∞–π–ª.");
        return;
      }
      if (!title) {
        title = file.name;
      }
      var url = URL.createObjectURL(file);
      var newId = "u_" + new Date().getTime();
      var newTrack = {
        id: newId,
        title: title,
        artist: artist || "–ú–æ–π —Ç—Ä–µ–∫",
        album: "–õ–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã",
        duration: "‚Äî:‚Äî",
        mood: "calm",
        url: url
      };
      tracks.push(newTrack);
      // –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Å—Ç–∞—ë–º—Å—è –≤ —Ç–µ–∫—É—â–µ–º —Ä–∞–∑–¥–µ–ª–µ, –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
      updateFilter();
      alert("–¢—Ä–µ–∫ –¥–æ–±–∞–≤–ª–µ–Ω. –ù–∞–π–¥–∏—Ç–µ –µ–≥–æ –≤ —Å–ø–∏—Å–∫–µ –∏ –Ω–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏.");
      userTrackTitle.value = "";
      userTrackArtist.value = "";
      userTrackFile.value = "";
    };

    var modalBackdrop = document.getElementById("modalBackdrop");
    var modalTitle = document.getElementById("modalTitle");
    var modalSub = document.getElementById("modalSub");
    var modalSwitchText = document.getElementById("modalSwitchText");
    var modalSwitchBtn = document.getElementById("modalSwitchBtn");
    var authForm = document.getElementById("authForm");
    var loginBtn = document.getElementById("loginBtn");
    var registerBtn = document.getElementById("registerBtn");
    var logoutBtn = document.getElementById("logoutBtn");
    var modalClose = document.getElementById("modalClose");
    var mode = "login";

    function openModal(newMode) {
      mode = newMode;
      if (mode === "login") {
        modalTitle.textContent = "–í—Ö–æ–¥";
        modalSub.textContent = "–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ localStorage. –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ.";
        modalSwitchText.textContent = "–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?";
        modalSwitchBtn.textContent = "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è";
      } else {
        modalTitle.textContent = "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è";
        modalSub.textContent = "–°–æ–∑–¥–∞–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç. –ü–æ—á—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –≤—Ö–æ–¥–∞.";
        modalSwitchText.textContent = "–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?";
        modalSwitchBtn.textContent = "–í–æ–π—Ç–∏";
      }
      modalBackdrop.style.display = "flex";
    }
    function closeModal() {
      modalBackdrop.style.display = "none";
    }

    loginBtn.onclick = function() { openModal("login"); };
    registerBtn.onclick = function() { openModal("register"); };
    modalClose.onclick = closeModal;
    modalBackdrop.onclick = function(e) {
      if (e.target === modalBackdrop) closeModal();
    };
    modalSwitchBtn.onclick = function() {
      openModal(mode === "login" ? "register" : "login");
    };

    authForm.onsubmit = function(e) {
      e.preventDefault();
      var email = document.getElementById("emailInput").value.replace(/\s+/g, "").toLowerCase();
      var password = document.getElementById("passwordInput").value;
      if (password.length < 4) {
        alert("–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –∫–æ—Ä–æ—á–µ 4 —Å–∏–º–≤–æ–ª–æ–≤.");
        return;
      }

      if (mode === "register") {
        if (findUserByEmail(email)) {
          alert("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏.");
          return;
        }
        var newUser = { email: email, password: password, likes: [], playlists: [] };
        users.push(newUser);
        saveUsers(users);
        currentUser = { email: email };
        saveCurrentUser(currentUser);
        alert("–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω –∏ –≤—ã –≤–æ—à–ª–∏ –≤ —Å–∏—Å—Ç–µ–º—É.");
      } else {
        var user = findUserByEmail(email);
        if (!user || user.password !== password) {
          alert("–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å.");
          return;
        }
        currentUser = { email: email };
        saveCurrentUser(currentUser);
        alert("–í—ã —É—Å–ø–µ—à–Ω–æ –≤–æ—à–ª–∏.");
      }
      closeModal();
      updateAuthUI();
    };

    logoutBtn.onclick = function() {
      currentUser = null;
      saveCurrentUser(null);
      updateAuthUI();
      alert("–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞.");
    };

    function updateAuthUI() {
      var user = getCurrentUserFull();
      if (user) {
        headerUserEmail.textContent = user.email;
        sidebarUserInfo.textContent = "–í—ã –≤–æ—à–ª–∏ –∫–∞–∫ " + user.email;
        playerStatus.textContent = "–í—ã –≤–æ—à–ª–∏ ¬∑ –ª–∞–π–∫–∏ –∏ –ø–ª–µ–π–ª–∏—Å—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ";
        loginBtn.style.display = "inline-block";
        registerBtn.style.display = "inline-block";
        loginBtn.style.display = "none";
        registerBtn.style.display = "none";
        logoutBtn.style.display = "inline-block";
      } else {
        headerUserEmail.textContent = "–ì–æ—Å—Ç—å";
        sidebarUserInfo.textContent = "–ì–æ—Å—Ç—å ¬∑ –≤–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç—Ä–µ–∫–∏ –∏ –ø–ª–µ–π–ª–∏—Å—Ç—ã";
        playerStatus.textContent = "–ì–æ—Å—Ç—å ¬∑ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –ø—Ä–∏ –≤—Ö–æ–¥–µ";
        loginBtn.style.display = "inline-block";
        registerBtn.style.display = "inline-block";
        logoutBtn.style.display = "none";
      }
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–æ–≤ –≤ —Å–∞–π–¥–±–∞—Ä–µ
    function setActiveNav(view) {
      currentView = view;
      navHome.classList.remove("active");
      navMyMusic.classList.remove("active");
      navPlaylists.classList.remove("active");

      if (view === "home") {
        navHome.classList.add("active");
        sectionTitle.textContent = "–ü–ª–µ–π–ª–∏—Å—Ç –¥–Ω—è";
        sectionSub.textContent = "–†–∞–±–æ—á–∏–π –ø–ª–µ–µ—Ä + —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ localStorage";
      } else if (view === "my") {
        navMyMusic.classList.add("active");
        sectionTitle.textContent = "–ú–æ—è –º—É–∑—ã–∫–∞";
        sectionSub.textContent = "–ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç—Ä–µ–∫–∏, –∫–æ—Ç–æ—Ä—ã–º –≤—ã –ø–æ—Å—Ç–∞–≤–∏–ª–∏ –ª–∞–π–∫";
      } else if (view === "playlists") {
        navPlaylists.classList.add("active");
        sectionTitle.textContent = "–ú–æ–∏ –ø–ª–µ–π–ª–∏—Å—Ç—ã";
        sectionSub.textContent = "–¢—Ä–µ–∫–∏, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–æ–π \"+ –î–æ–±–∞–≤–∏—Ç—å –≤ –ø–ª–µ–π–ª–∏—Å—Ç\"";
      }

      updateFilter();
    }

    navHome.onclick = function() { setActiveNav("home"); };
    navMyMusic.onclick = function() { setActiveNav("my"); };
    navPlaylists.onclick = function() { setActiveNav("playlists"); };

    function init() {
      currentUser = loadCurrentUser();
      updateAuthUI();
      filteredTracks = tracks.slice();
      renderTracks(filteredTracks);
      loadTrack(0);
      setActiveNav("home");
    }

    init();
  </script>
</body>
</html>